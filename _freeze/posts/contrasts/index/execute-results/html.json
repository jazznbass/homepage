{
  "hash": "49029c4e2f693790fa75dfc32ef2935f",
  "result": {
    "markdown": "---\ntitle: \"Contrasts in single-cases\"\nauthor: JÃ¼rgen Wilbert\ndate: 2022/09/27\nabstract: Contrasts in regression modells\ncategories: \n  - contrasts\n  - regression\n  - statistics\ndraft: true\n---\n\n\n\n\n# Example dataset\n\n::: panel-tabset\n\n## plot\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n## table\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-classic\" style=\"width: auto !important; \">\n<caption>Single case data frame with 1 cases</caption>\n <thead>\n<tr><th style=\"border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; \" colspan=\"3\"><div style=\"border-bottom: 1px solid #ddd; padding-bottom: 5px; \">Pawel</div></th></tr>\n  <tr>\n   <th style=\"text-align:center;\"> values </th>\n   <th style=\"text-align:center;\"> mt </th>\n   <th style=\"text-align:center;\"> phase </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;\"> 10 </td>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> A1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 19 </td>\n   <td style=\"text-align:center;\"> 2 </td>\n   <td style=\"text-align:center;\"> A1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 11 </td>\n   <td style=\"text-align:center;\"> 3 </td>\n   <td style=\"text-align:center;\"> A1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 6 </td>\n   <td style=\"text-align:center;\"> 4 </td>\n   <td style=\"text-align:center;\"> A1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 16 </td>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> A1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 16 </td>\n   <td style=\"text-align:center;\"> 6 </td>\n   <td style=\"text-align:center;\"> A1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 17 </td>\n   <td style=\"text-align:center;\"> 7 </td>\n   <td style=\"text-align:center;\"> A1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 18 </td>\n   <td style=\"text-align:center;\"> 8 </td>\n   <td style=\"text-align:center;\"> A1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 12 </td>\n   <td style=\"text-align:center;\"> 9 </td>\n   <td style=\"text-align:center;\"> A1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 12 </td>\n   <td style=\"text-align:center;\"> 10 </td>\n   <td style=\"text-align:center;\"> A1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 39 </td>\n   <td style=\"text-align:center;\"> 11 </td>\n   <td style=\"text-align:center;\"> B1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 18 </td>\n   <td style=\"text-align:center;\"> 12 </td>\n   <td style=\"text-align:center;\"> B1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 25 </td>\n   <td style=\"text-align:center;\"> 13 </td>\n   <td style=\"text-align:center;\"> B1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 31 </td>\n   <td style=\"text-align:center;\"> 14 </td>\n   <td style=\"text-align:center;\"> B1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 29 </td>\n   <td style=\"text-align:center;\"> 15 </td>\n   <td style=\"text-align:center;\"> B1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 24 </td>\n   <td style=\"text-align:center;\"> 16 </td>\n   <td style=\"text-align:center;\"> B1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 37 </td>\n   <td style=\"text-align:center;\"> 17 </td>\n   <td style=\"text-align:center;\"> B1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 17 </td>\n   <td style=\"text-align:center;\"> 18 </td>\n   <td style=\"text-align:center;\"> B1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 21 </td>\n   <td style=\"text-align:center;\"> 19 </td>\n   <td style=\"text-align:center;\"> B1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 18 </td>\n   <td style=\"text-align:center;\"> 20 </td>\n   <td style=\"text-align:center;\"> B1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 16 </td>\n   <td style=\"text-align:center;\"> 21 </td>\n   <td style=\"text-align:center;\"> A2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 17 </td>\n   <td style=\"text-align:center;\"> 22 </td>\n   <td style=\"text-align:center;\"> A2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 19 </td>\n   <td style=\"text-align:center;\"> 23 </td>\n   <td style=\"text-align:center;\"> A2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 21 </td>\n   <td style=\"text-align:center;\"> 24 </td>\n   <td style=\"text-align:center;\"> A2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 10 </td>\n   <td style=\"text-align:center;\"> 25 </td>\n   <td style=\"text-align:center;\"> A2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 11 </td>\n   <td style=\"text-align:center;\"> 26 </td>\n   <td style=\"text-align:center;\"> A2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 23 </td>\n   <td style=\"text-align:center;\"> 27 </td>\n   <td style=\"text-align:center;\"> A2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 11 </td>\n   <td style=\"text-align:center;\"> 28 </td>\n   <td style=\"text-align:center;\"> A2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 10 </td>\n   <td style=\"text-align:center;\"> 29 </td>\n   <td style=\"text-align:center;\"> A2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 9 </td>\n   <td style=\"text-align:center;\"> 30 </td>\n   <td style=\"text-align:center;\"> A2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 34 </td>\n   <td style=\"text-align:center;\"> 31 </td>\n   <td style=\"text-align:center;\"> B2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 35 </td>\n   <td style=\"text-align:center;\"> 32 </td>\n   <td style=\"text-align:center;\"> B2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 28 </td>\n   <td style=\"text-align:center;\"> 33 </td>\n   <td style=\"text-align:center;\"> B2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 30 </td>\n   <td style=\"text-align:center;\"> 34 </td>\n   <td style=\"text-align:center;\"> B2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 22 </td>\n   <td style=\"text-align:center;\"> 35 </td>\n   <td style=\"text-align:center;\"> B2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 21 </td>\n   <td style=\"text-align:center;\"> 36 </td>\n   <td style=\"text-align:center;\"> B2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 21 </td>\n   <td style=\"text-align:center;\"> 37 </td>\n   <td style=\"text-align:center;\"> B2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 22 </td>\n   <td style=\"text-align:center;\"> 38 </td>\n   <td style=\"text-align:center;\"> B2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 23 </td>\n   <td style=\"text-align:center;\"> 39 </td>\n   <td style=\"text-align:center;\"> B2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 34 </td>\n   <td style=\"text-align:center;\"> 40 </td>\n   <td style=\"text-align:center;\"> B2 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n:::\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# mean of all phases\n\n(means <- tapply(df$values, df$phase, mean))\n  A1   B1   A2   B2 \n13.7 25.9 14.7 27.0 \n(grand_mean <- mean(means))\n[1] 20.325\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plm function reference:\nplm(exampleA1B1A2B2$Pawel, contrast = \"first\", trend = FALSE, slope = FALSE) %>% coef() %>% .[,1]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n(Intercept)     phaseB1     phaseA2     phaseB2 \n       13.7        12.2         1.0        13.3 \n```\n:::\n\n```{.r .cell-code}\nplm(exampleA1B1A2B2$Pawel, contrast = \"preceding\", trend = FALSE, slope = FALSE) %>% coef() %>% .[,1]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n(Intercept)     phaseB1     phaseA2     phaseB2 \n       13.7        12.2       -11.2        12.3 \n```\n:::\n:::\n\n\n# Contrasts\n\n## Treatment contrast\n\n*Compare mean of second to last phase against first phase (intercept)*\n\nThe Intercept is the mean of a reference phase (defaults to the first).\\\nThe predictors are the differences from a phase to the reference (intercept).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntreatment <- contr.treatment(4)\ncolnames(treatment) <- c(\"B1vsA1\",\"A2vsA1\",\"B2vsA1\")\ntreatment\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  B1vsA1 A2vsA1 B2vsA1\n1      0      0      0\n2      1      0      0\n3      0      1      0\n4      0      0      1\n```\n:::\n\n```{.r .cell-code}\nlm(values~phase, data=df, contrasts = list(phase = treatment)) |> coef()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n(Intercept) phaseB1vsA1 phaseA2vsA1 phaseB2vsA1 \n       13.7        12.2         1.0        13.3 \n```\n:::\n\n```{.r .cell-code}\nc(Intercept = 13.7, # phaseA1\n  phaseB1vsA1 = 25.9 - 13.7, \n  phaseA2vsA1 = 14.7 - 13.7,\n  phaseB2vsA1 = 27 - 13.7)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Intercept phaseB1vsA1 phaseA2vsA1 phaseB2vsA1 \n       13.7        12.2         1.0        13.3 \n```\n:::\n:::\n\n\n## Sum contrast\n\n*Comparison from the first to the second last phase with the overall mean (Intercept is overall mean)*\n\nThe Intercept is the overall mean.\\\nThe predictors are the differences from a phase mean to the overall mean.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsum <- contr.sum(4)\ncolnames(sum) <- c(\"A1vsMean\",\"B1vsMean\",\"A2vsMean\")\nsum\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  A1vsMean B1vsMean A2vsMean\n1        1        0        0\n2        0        1        0\n3        0        0        1\n4       -1       -1       -1\n```\n:::\n\n```{.r .cell-code}\nlm(values~phase, data=df, contrasts = list(phase = sum)) |> coef()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  (Intercept) phaseA1vsMean phaseB1vsMean phaseA2vsMean \n       20.325        -6.625         5.575        -5.625 \n```\n:::\n\n```{.r .cell-code}\nc(Intercept = grand_mean,\n  phaseA1vsMean = 13.7 - grand_mean, \n  phaseB1vsMean = 25.9 - grand_mean, \n  phaseA2vsMean = 14.7 - grand_mean)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n    Intercept phaseA1vsMean phaseB1vsMean phaseA2vsMean \n       20.325        -6.625         5.575        -5.625 \n```\n:::\n:::\n\n\n## Helmert contrast\n\n*Compares from the second to the last phase with the mean of all preceding phases.*\n\nThe Intercept is the overall mean.\\\nThe predictors are the mean differences from a phase mean to the mean of all preceding phases.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhelmert <- contr.helmert(4)\ncolnames(helmert) <- c(\"B1vsA1\", \"A2vsA1_B1\", \"B2vsA1_B1_A2\")\nhelmert\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  B1vsA1 A2vsA1_B1 B2vsA1_B1_A2\n1     -1        -1           -1\n2      1        -1           -1\n3      0         2           -1\n4      0         0            3\n```\n:::\n\n```{.r .cell-code}\nlm(values~phase, data=df, contrasts = list(phase = helmert)) |> coef()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      (Intercept)       phaseB1vsA1    phaseA2vsA1_B1 phaseB2vsA1_B1_A2 \n           20.325             6.100            -1.700             2.225 \n```\n:::\n\n```{.r .cell-code}\nc(Intercept = grand_mean,\n  phaseB1vsA1 = (25.9 + -13.7) / 2, \n  phaseA2vsA1_B1 = (14.7  + (-13.7-25.9)/2) / 3,\n  phaseB2vsA1_B1_A2 = (27 + (-13.7-25.9-14.7)/3) /4)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        Intercept       phaseB1vsA1    phaseA2vsA1_B1 phaseB2vsA1_B1_A2 \n           20.325             6.100            -1.700             2.225 \n```\n:::\n:::\n\n\n## Revert Helmert\n\n*Comparing the second to last phase against the mean of all preceding phases*\n\nThe Intercept is the grand mean.\\\nThe predictors are the differences from a phase to the mean of the preeding phases.\n\n*Compare phase2 vs. phase 1, phase 3 vs. mean of phase 1 and 2, phase4 vs. mean of phases 1,2,3 (Intercept is overall mean)*\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrevers_helmert <- matrix(c(-1/2, 1/2, 0, 0, -1/3, -1/3, 2/3, 0, -1/4, -1/4, -1/4, 3/4), ncol = 3)\ncolnames(revers_helmert) <- c(\"B1vsA1\", \"A2vsA1_B1\", \"B2vsA1_B1_A2\")\nrevers_helmert\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     B1vsA1  A2vsA1_B1 B2vsA1_B1_A2\n[1,]   -0.5 -0.3333333        -0.25\n[2,]    0.5 -0.3333333        -0.25\n[3,]    0.0  0.6666667        -0.25\n[4,]    0.0  0.0000000         0.75\n```\n:::\n\n```{.r .cell-code}\nlm(values~phase, data=df, contrasts = list(phase = revers_helmert)) |> coef()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      (Intercept)       phaseB1vsA1    phaseA2vsA1_B1 phaseB2vsA1_B1_A2 \n           20.325            12.200            -5.100             8.900 \n```\n:::\n\n```{.r .cell-code}\nc(Intercept = grand_mean,\n  phaseB1vsA1 = 25.7 - 13.7,\n  phaseA2vsA1_B1 = 14.7 - (13.7+25.9)/2,\n  phaseB2vsA1_B1_A2 = 27 - (13.7+25.9+14.7)/3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        Intercept       phaseB1vsA1    phaseA2vsA1_B1 phaseB2vsA1_B1_A2 \n           20.325            12.000            -5.100             8.900 \n```\n:::\n:::\n\n\n## Cummulative\n\n*Compare mean of second to last phase to mean of preceding phase*\n\nThe Intercept is the mean of the first phase.\\\nThe predictors are the differences from a phase to the preeding phase.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncumulative <- matrix(c(0,1,1,1, 0,0,1,1, 0,0,0,1), ncol = 3)\ncolnames(cumulative) <- c(\"B1vsA1\",\"A2vsB1\",\"B2vsA2\")\ncumulative\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     B1vsA1 A2vsB1 B2vsA2\n[1,]      0      0      0\n[2,]      1      0      0\n[3,]      1      1      0\n[4,]      1      1      1\n```\n:::\n\n```{.r .cell-code}\nlm(values~phase, data=df, contrasts = list(phase = cumulative)) |> coef()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n(Intercept) phaseB1vsA1 phaseA2vsB1 phaseB2vsA2 \n       13.7        12.2       -11.2        12.3 \n```\n:::\n\n```{.r .cell-code}\nc(Intercept = 13.7,\n  phaseB1vsA1 = 25.9 - 13.7, \n  phaseA2vsB1 = 14.7 - 25.9,\n  phaseB2vsA2 = 27 - 14.7)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Intercept phaseB1vsA1 phaseA2vsB1 phaseB2vsA2 \n       13.7        12.2       -11.2        12.3 \n```\n:::\n:::\n\n\n# Contrast computation\n\n## treatment\n\n\n::: {.cell}\n\n```{.r .cell-code}\n(treatment <- contr.treatment(4))\n  2 3 4\n1 0 0 0\n2 1 0 0\n3 0 1 0\n4 0 0 1\n(treatment <-  cbind(1, treatment))\n    2 3 4\n1 1 0 0 0\n2 1 1 0 0\n3 1 0 1 0\n4 1 0 0 1\n\n(treatment <- solve(t(treatment)))\n     2  3  4\n1 1 -1 -1 -1\n2 0  1  0  0\n3 0  0  1  0\n4 0  0  0  1\n(treatment <- treatment[,-1])\n   2  3  4\n1 -1 -1 -1\n2  1  0  0\n3  0  1  0\n4  0  0  1\n\ncolnames(treatment) <- c(\"B1vsA1\",\"A2vsA1\",\"B2vsA1\")\n\nlm(values~phase, data=df, contrasts = list(phase = treatment)) |> summary()\n\nCall:\nlm(formula = values ~ phase, data = df, contrasts = list(phase = treatment))\n\nResiduals:\n   Min     1Q Median     3Q    Max \n -8.90  -4.75  -1.30   4.30  13.10 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  20.3250     0.9373  21.684  < 2e-16 ***\nphaseB1vsA1   5.5750     1.6235   3.434 0.001513 ** \nphaseA2vsA1  -5.6250     1.6235  -3.465 0.001389 ** \nphaseB2vsA1   6.6750     1.6235   4.112 0.000217 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 5.928 on 36 degrees of freedom\nMultiple R-squared:  0.5444,\tAdjusted R-squared:  0.5064 \nF-statistic: 14.34 on 3 and 36 DF,  p-value: 2.635e-06\n```\n:::\n\n\n## sum\n\n\n::: {.cell}\n\n```{.r .cell-code}\n(sum <- contr.sum(4))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  [,1] [,2] [,3]\n1    1    0    0\n2    0    1    0\n3    0    0    1\n4   -1   -1   -1\n```\n:::\n\n```{.r .cell-code}\n(sum <-  cbind(1, sum))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  [,1] [,2] [,3] [,4]\n1    1    1    0    0\n2    1    0    1    0\n3    1    0    0    1\n4    1   -1   -1   -1\n```\n:::\n\n```{.r .cell-code}\n(sum <- solve(t(sum)))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  [,1]  [,2]  [,3]  [,4]\n1 0.25  0.75 -0.25 -0.25\n2 0.25 -0.25  0.75 -0.25\n3 0.25 -0.25 -0.25  0.75\n4 0.25 -0.25 -0.25 -0.25\n```\n:::\n\n```{.r .cell-code}\n(sum <- sum[,-1])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   [,1]  [,2]  [,3]\n1  0.75 -0.25 -0.25\n2 -0.25  0.75 -0.25\n3 -0.25 -0.25  0.75\n4 -0.25 -0.25 -0.25\n```\n:::\n\n```{.r .cell-code}\ncolnames(sum) <- c(\"A1vsMean\",\"B1vsMean\",\"A2vsMean\")\n\n\nlm(values~phase, data=df, contrasts = list(phase = sum)) |> coef()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  (Intercept) phaseA1vsMean phaseB1vsMean phaseA2vsMean \n       20.325       -13.300        -1.100       -12.300 \n```\n:::\n\n```{.r .cell-code}\nc(Intercept = grand_mean,\n  phaseA1vsMean = 13.7 - grand_mean, \n  phaseB1vsMean = 25.9 - grand_mean, \n  phaseA2vsMean = 14.7 - grand_mean)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n    Intercept phaseA1vsMean phaseB1vsMean phaseA2vsMean \n       20.325        -6.625         5.575        -5.625 \n```\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}